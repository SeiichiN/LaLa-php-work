<style>
.my-text {
background-color: #f5f5f5;
padding: 10px;
margin-left: 30%;
}
</style>

<div class="my-text">
次のコードがあります。
```
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div>
  <?php
  $discount = 0.8;
  $off = (1 - $discount) * 100;
  if ($discount > 0) {
    echo "<h2>このページでのご購入は{$off}％ OFFになります</h2>";
  }
  $tanka = 2900;
  $tanka_fmt = number_format($tanka);
  ?>
  <form action="discount.php" method="post">
    <input type="hidden" name="discount" value="<?php echo $discount; ?>">
    <input type="hidden" name="tanka" value="<?php echo $tanka; ?>">
    <ul>
      <li>単価：<?php echo $tanka_fmt; ?>円</li>
      <li><label>個数：<input type="number" name="kosu"></label></li>
      <li><input type="submit" value="計算する"></li>
    </ul>
  </form>
  </div>
</body>
</html>
```
このページ内で宣言している変数として、`$off`、`$discount`、`$tanka`がありますが、それぞれ echo するときに、htmlspecialchars()関数を使う必要がありますか？
フォームから入力された値でないので、僕はHTMLエスケープする必要はないと思うのですが。
</div>

---

とても良い質問です。結論から言うと、あなたの判断は**正しい**です。
このコードの `$off`、`$discount`、`$tanka` については、**`htmlspecialchars()` を使う必要はありません**。

---

### 理由を詳しく説明します

`htmlspecialchars()` は、主に **外部から受け取ったデータ**（ユーザー入力やURLパラメータ、フォーム送信値など）を **HTMLに埋め込む際のXSS対策**（クロスサイトスクリプティング防止）のために使います。

しかし、あなたのコードでは：

| 変数           | 値の由来                           | 外部入力か？ | エスケープ必要？ | 理由                            |
| ------------ | ------------------------------ | ------ | -------- | ----------------------------- |
| `$discount`  | `0.8`（プログラム内で定義）               | ✗      | 不要       | 外部データでなく、開発者が直接定義した定数的値だから安全  |
| `$off`       | `$discount`から計算された値            | ✗      | 不要       | `$discount`に依存しており、外部からの入力でない |
| `$tanka`     | `2900`（プログラム内で定義）              | ✗      | 不要       | 外部入力ではない                      |
| `$tanka_fmt` | `$tanka`を `number_format()`で整形 | ✗      | 不要       | 同上                            |

---

### ただし、次のような場合は注意

もし将来、このコードが次のように変わるなら話は別です。

```php
$discount = $_POST['discount'] ?? 0.8;
```

など、**外部（ユーザー入力やリクエスト）から値を受け取る**ようになった場合は、
`echo htmlspecialchars($discount, ENT_QUOTES, 'UTF-8');`
のようにエスケープが必要になります。

---

### まとめ

* 現状のコードでは、すべて内部で定義された値 → **`htmlspecialchars()`不要**。
* ただし、将来的にフォーム入力・クエリパラメータなどで値を受け取るようになったら → **必要になる**。

---

✅ **結論**

> 今のコードの `$off`、`$discount`、`$tanka` は、すべて開発者が定義した内部値なので、`htmlspecialchars()`は不要です。


<!-- 修正時刻: Tue 2025/10/21 06:24:47 -->
